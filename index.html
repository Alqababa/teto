<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ูุธุงู ุชุณุฌูู ุงูููุงุชูุฑ</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
  <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-firestore-compat.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
  <style>
    .nav-tabs .nav-link.active {
      background-color: #0d6efd;
      color: #fff;
    }
  </style>
</head>
<body class="bg-light">
  <div class="container py-4">
    <ul class="nav nav-tabs mb-4" id="tabs">
      <li class="nav-item">
        <button class="nav-link active" id="add-invoice-tab" data-bs-toggle="tab" data-bs-target="#addInvoice">ุชุณุฌูู ูุงุชูุฑุฉ</button>
      </li>
      <li class="nav-item">
        <button class="nav-link" id="supplier-summary-tab" data-bs-toggle="tab" data-bs-target="#supplierSummary" a href="supplier-report.html">ููุงุชูุฑ ุงูููุฑุฏ</button>
      </li>
      <li class="nav-item">
        <button class="nav-link" id="monthly-summary-tab" data-bs-toggle="tab" data-bs-target="#monthlySummary">ููุงุชูุฑ ุงูุดูุฑ</button>
      </li>
    </ul>

    <div class="tab-content">
      <div class="tab-pane fade show active" id="addInvoice">
        <form id="invoiceForm">
          <div class="mb-3">
            <label>ุงุณู ุงูุดุฑูุฉ / ุงูููุฑุฏ</label>
            <input type="text" id="supplier" class="form-control" required>
          </div>
          <div class="mb-3">
            <label>ุชุงุฑูุฎ ุงููุงุชูุฑุฉ</label>
            <input type="date" id="invoiceDate" class="form-control" required>
          </div>
          <div class="mb-3">
            <label>ููุงุญุธุงุช (ุงุฎุชูุงุฑู)</label>
            <textarea id="notes" class="form-control"></textarea>
          </div>
          <div id="itemsContainer" class="mb-3"></div>
          <button type="button" class="btn btn-secondary mb-3" id="addItemBtn">โ ุฅุถุงูุฉ ูุงุฏุฉ</button>
          <div class="mb-3">
            <strong>ุงููุฌููุน: <span id="totalAmount">0.00</span> AED</strong>
            <input type="hidden" id="totalAmountInput">
          </div>
          <button type="submit" class="btn btn-success">๐พ ุญูุธ ุงููุงุชูุฑุฉ</button>
          <div id="successAlert" class="alert alert-success mt-3" style="display: none;">ุชู ุญูุธ ุงููุงุชูุฑุฉ ุจูุฌุงุญ โ</div>
        </form>
      </div>

      <div class="tab-pane fade" id="supplierSummary">
        <!-- ุณูุชู ุชุนุจุฆุชู ูู js -->
      </div>

      <div class="tab-pane fade" id="monthlySummary">
        <!-- ุณูุชู ุชุนุจุฆุชู ูู js -->
      </div>
    </div>

    <div class="mt-4 text-end">
      <button onclick="exportToExcel()" class="btn btn-outline-dark">๐ค ุชุตุฏูุฑ Excel</button>
      <button onclick="exportToPDF()" class="btn btn-outline-danger">๐ ุชุตุฏูุฑ PDF</button>
    </div>
  </div>

  <script src="app.js"></script>
  <script>
    function exportToExcel() {
      const tables = document.querySelectorAll(".tab-pane.active ul");
      if (!tables.length) return alert("ูุง ุชูุฌุฏ ุจูุงูุงุช ููุชุตุฏูุฑ");

      const data = [];
      tables[0].querySelectorAll("li").forEach(row => {
        const label = row.childNodes[0].textContent.trim();
        const value = row.querySelector(".badge").textContent;
        data.push([label, value]);
      });

      const wb = XLSX.utils.book_new();
      const ws = XLSX.utils.aoa_to_sheet([["ุงูุชุตููู", "ุงููููุฉ"], ...data]);
      XLSX.utils.book_append_sheet(wb, ws, "ุชูุฑูุฑ");
      XLSX.writeFile(wb, "report.xlsx");
    }

    async function exportToPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      const rows = [];
      document.querySelectorAll(".tab-pane.active ul li").forEach((li, i) => {
        const label = li.childNodes[0].textContent.trim();
        const value = li.querySelector(".badge").textContent;
        rows.push([label, value]);
      });
      doc.text("ุชูุฑูุฑ ุงูููุงุชูุฑ", 14, 20);
      doc.autoTable({
        head: [["ุงูุชุตููู", "ุงููููุฉ"]],
        body: rows,
        startY: 30
      });
      doc.save("report.pdf");
    }
  </script>
</body>
</html>
