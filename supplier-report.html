
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ù…Ø¬Ù…ÙˆØ¹ ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…ÙˆØ±Ø¯</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
  <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-firestore-compat.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
</head>
<body class="container py-5">
  <h3 class="mb-4">Ù…Ø¬Ù…ÙˆØ¹ ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…ÙˆØ±Ø¯</h3>

  <input type="text" id="supplierName" class="form-control mb-3" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ±Ø¯">
  <button onclick="getSupplierReport()" class="btn btn-primary mb-3">Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
  <div id="report"></div>
  <div class="mt-3">
    <button onclick="exportExcel()" class="btn btn-outline-success">ğŸ“¤ ØªØµØ¯ÙŠØ± Excel</button>
    <button onclick="exportPDF()" class="btn btn-outline-danger">ğŸ“„ ØªØµØ¯ÙŠØ± PDF</button>
  </div>

  <script>
    const firebaseConfig = { /* Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù‡Ù†Ø§ */ };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    async function getSupplierReport() {
      const name = document.getElementById("supplierName").value.toLowerCase();
      const snapshot = await db.collection("invoices").get();
      const rows = [];

      snapshot.forEach(doc => {
        const data = doc.data();
        if (data.supplier && data.supplier.toLowerCase().includes(name)) {
          rows.push([data.supplier, data.invoiceDate, data.totalAmount + " AED"]);
        }
      });

      let html = `<table class='table table-bordered'><thead><tr><th>Ø§Ù„Ù…ÙˆØ±Ø¯</th><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</th></tr></thead><tbody>`;
      rows.forEach(r => html += `<tr><td>${r[0]}</td><td>${r[1]}</td><td>${r[2]}</td></tr>`);
      html += `</tbody></table>`;
      document.getElementById("report").innerHTML = html;
    }

    function exportExcel() {
      const wb = XLSX.utils.book_new();
      const table = document.querySelector("table");
      const ws = XLSX.utils.table_to_sheet(table);
      XLSX.utils.book_append_sheet(wb, ws, "ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…ÙˆØ±Ø¯");
      XLSX.writeFile(wb, "supplier_report.xlsx");
    }

    function exportPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      doc.text("ØªÙ‚Ø±ÙŠØ± ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…ÙˆØ±Ø¯", 14, 20);
      doc.autoTable({ html: 'table', startY: 30 });
      doc.save("supplier_report.pdf");
    }
  </script>
</body>
</html>
